{% extends "admin/base_admin.html" %}
{% block title %}Kullanıcılar - Norya Admin{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold text-white mb-4">Kullanıcı Yönetimi</h1>
<form method="get" class="mb-4 flex gap-2">
  <input type="text" name="q" value="{{ q }}" placeholder="E-posta ara..." class="px-3 py-2 rounded-lg bg-slate-800 border border-slate-600 text-white w-64" />
  <button type="submit" class="px-4 py-2 rounded-lg bg-brand text-white">Ara</button>
</form>
<form id="bulk-form" method="post" action="/admin/users/bulk-ban" class="mb-2">
  <button type="button" onclick="document.getElementById('bulk-form').action='/admin/users/bulk-ban'; document.getElementById('bulk-form').submit();" class="px-3 py-1.5 rounded bg-red-600 text-white text-sm mr-2">Seçilenleri yasakla</button>
  <button type="button" onclick="document.getElementById('bulk-form').action='/admin/users/bulk-unban'; document.getElementById('bulk-form').submit();" class="px-3 py-1.5 rounded bg-green-600 text-white text-sm">Seçilenlerin yasağını kaldır</button>
</form>
<div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
  <table class="w-full text-sm">
    <thead>
      <tr class="text-left text-slate-400 border-b border-slate-700">
        <th class="px-4 py-2 w-8"><input type="checkbox" id="select-all" title="Tümünü seç" /></th>
        <th class="px-4 py-2">ID</th>
        <th class="px-4 py-2">E-posta</th>
        <th class="px-4 py-2">Doğr.</th>
        <th class="px-4 py-2">Ad</th>
        <th class="px-4 py-2">Plan</th>
        <th class="px-4 py-2">Analiz</th>
        <th class="px-4 py-2">Son giriş</th>
        <th class="px-4 py-2">Durum</th>
        <th class="px-4 py-2"></th>
      </tr>
    </thead>
    <tbody>
      {% for u in users %}
      <tr class="border-b border-slate-700/50 hover:bg-slate-700/30">
        <td class="px-4 py-2"><input type="checkbox" name="user_id" value="{{ u.id }}" form="bulk-form" class="user-cb" /></td>
        <td class="px-4 py-2">{{ u.id }}</td>
        <td class="px-4 py-2">{{ u.email }}</td>
        <td class="px-4 py-2">{% if u.email_verified %}<span class="text-green-400">Evet</span>{% else %}<span class="text-slate-500">Hayır</span>{% endif %}</td>
        <td class="px-4 py-2">{{ u.full_name }}</td>
        <td class="px-4 py-2">{{ u.plan }} ({{ u.extra_credits }} hak)</td>
        <td class="px-4 py-2">{{ u.analysis_count }}</td>
        <td class="px-4 py-2">{{ u.last_login }}</td>
        <td class="px-4 py-2">{% if u.is_banned %}<span class="text-red-400">Yasaklı</span>{% else %}<span class="text-green-400">Aktif</span>{% endif %}</td>
        <td class="px-4 py-2"><a href="/admin/users/{{ u.id }}" class="text-brand hover:underline">Detay</a></td>
      </tr>
      {% else %}
      <tr><td colspan="10" class="px-4 py-4 text-slate-500">Kullanıcı yok.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<script>
document.getElementById('select-all')?.addEventListener('change', function() {
  document.querySelectorAll('.user-cb').forEach(function(cb) { cb.checked = document.getElementById('select-all').checked; });
});
</script>
{% endblock %}

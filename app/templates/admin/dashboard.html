{% extends "admin/base_admin.html" %}
{% block title %}Dashboard - Norya Admin{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold text-white mb-6">Dashboard</h1>

<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
  <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
    <p class="text-slate-400 text-sm">Günlük satış (EUR)</p>
    <p class="text-2xl font-bold text-brand">{{ daily_sales }} €</p>
  </div>
  <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
    <p class="text-slate-400 text-sm">Aylık satış (EUR)</p>
    <p class="text-2xl font-bold text-brand">{{ monthly_sales }} €</p>
  </div>
  <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
    <p class="text-slate-400 text-sm">Toplam kullanıcı</p>
    <p class="text-2xl font-bold text-white">{{ total_users }}</p>
  </div>
  <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
    <p class="text-slate-400 text-sm">Aktif kullanıcı (son 2 dk)</p>
    <p class="text-2xl font-bold text-white">{{ active_users }}</p>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
  <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
    <p class="text-slate-400 text-sm mb-2">Ortalama analiz süresi</p>
    <p class="text-xl text-white">{{ avg_analysis_time }}</p>
  </div>
  <div class="bg-slate-800 rounded-lg border border-slate-700 p-4">
    <p class="text-slate-400 text-sm mb-2">Başarısız ödeme sayısı</p>
    <p class="text-xl text-white">{{ failed_payments }}</p>
  </div>
</div>

<div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
  <h2 class="text-lg font-medium text-white px-4 py-3 border-b border-slate-700">Son 10 işlem</h2>
  <div class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="text-left text-slate-400 border-b border-slate-700">
          <th class="px-4 py-2">Tarih</th>
          <th class="px-4 py-2">merchant_oid</th>
          <th class="px-4 py-2">Kullanıcı</th>
          <th class="px-4 py-2">Ürün</th>
          <th class="px-4 py-2">Tutar (EUR)</th>
          <th class="px-4 py-2">Durum</th>
        </tr>
      </thead>
      <tbody>
        {% for t in last_transactions %}
        <tr class="border-b border-slate-700/50 hover:bg-slate-700/30">
          <td class="px-4 py-2">{{ t.created_at }}</td>
          <td class="px-4 py-2 font-mono text-xs">{{ t.merchant_oid }}</td>
          <td class="px-4 py-2">{{ t.user_email or t.user_id }}</td>
          <td class="px-4 py-2">{{ t.product }}</td>
          <td class="px-4 py-2">{{ "%.2f"|format(t.amount_kurus / 100) }} €</td>
          <td class="px-4 py-2"><span class="{% if t.status == 'completed' %}text-green-400{% elif t.status == 'failed' %}text-red-400{% else %}text-amber-400{% endif %}">{{ t.status }}</span></td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="px-4 py-4 text-slate-500">İşlem yok.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}

{% extends "admin/base_admin.html" %}
{% block title %}Ã–demeler - Norya Admin{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold text-white mb-4">SatÄ±ÅŸ & Ã–deme Paneli</h1>

<div class="mb-6 p-4 rounded-xl bg-amber-900/40 border-2 border-amber-600 text-amber-100">
  <p class="font-semibold mb-2">ğŸ“„ E-arÅŸiv fatura nasÄ±l kesilir?</p>
  <ol class="list-decimal list-inside text-sm space-y-1">
    <li>Bu sayfada tabloda <strong>Fatura</strong> sÃ¼tununa bakÄ±n.</li>
    <li><strong>Kes</strong> yazan satÄ±ra tÄ±klayÄ±n (veya o satÄ±rda <strong>Detay</strong>a tÄ±klayÄ±n).</li>
    <li>AÃ§Ä±lan sipariÅŸ sayfasÄ±nda aÅŸaÄŸÄ± kaydÄ±rÄ±n; <strong>Â«E-arÅŸiv fatura kesÂ»</strong> formunu doldurup gÃ¶nderin.</li>
  </ol>
  <p class="text-xs text-amber-200/80 mt-2">Sadece <strong>tamamlanmÄ±ÅŸ</strong> (completed) sipariÅŸlerde fatura kesilebilir.</p>
</div>

<p class="text-slate-400 text-sm mb-4">Ã–demeler (EUR). Webhook: <code class="bg-slate-700 px-1 rounded">/payment/callback</code></p>
<div class="flex gap-2 mb-4">
  <a href="/admin/payments" class="px-3 py-1.5 rounded {% if not status_filter %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">TÃ¼mÃ¼</a>
  <a href="/admin/payments?status_filter=completed" class="px-3 py-1.5 rounded {% if status_filter == 'completed' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">BaÅŸarÄ±lÄ±</a>
  <a href="/admin/payments?status_filter=failed" class="px-3 py-1.5 rounded {% if status_filter == 'failed' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">BaÅŸarÄ±sÄ±z</a>
  <a href="/admin/payments?status_filter=pending" class="px-3 py-1.5 rounded {% if status_filter == 'pending' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Bekleyen</a>
</div>
<div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
  <table class="w-full text-sm">
    <thead>
      <tr class="text-left text-slate-400 border-b border-slate-700">
        <th class="px-4 py-2">Tarih</th>
        <th class="px-4 py-2">merchant_oid</th>
        <th class="px-4 py-2">KullanÄ±cÄ±</th>
        <th class="px-4 py-2">ÃœrÃ¼n</th>
        <th class="px-4 py-2">Tutar (EUR)</th>
        <th class="px-4 py-2">Durum</th>
        <th class="px-4 py-2">Fatura</th>
        <th class="px-4 py-2">Ä°ÅŸlendi</th>
        <th class="px-4 py-2">Not</th>
        <th class="px-4 py-2"></th>
      </tr>
    </thead>
    <tbody>
      {% for p in payments %}
      <tr class="border-b border-slate-700/50 hover:bg-slate-700/30">
        <td class="px-4 py-2">{{ p.created_at }}</td>
        <td class="px-4 py-2 font-mono text-xs">{{ p.merchant_oid }}</td>
        <td class="px-4 py-2">{{ p.user_email or p.user_id }}</td>
        <td class="px-4 py-2">{{ p.product }}</td>
        <td class="px-4 py-2">{{ "%.2f"|format(p.amount_eur) }} â‚¬</td>
        <td class="px-4 py-2"><span class="{% if p.status == 'completed' %}text-green-400{% elif p.status == 'failed' %}text-red-400{% else %}text-amber-400{% endif %}">{{ p.status }}</span></td>
        <td class="px-4 py-2">
          {% if p.invoice_ettn %}
            <span class="text-green-400" title="ETTN: {{ p.invoice_ettn }}">Kesildi</span>
          {% elif p.status == 'completed' %}
            <a href="/admin/payments/{{ p.id }}#fatura" class="text-amber-400 hover:underline">Kes</a>
          {% else %}
            <span class="text-slate-500">â€”</span>
          {% endif %}
        </td>
        <td class="px-4 py-2">
          {% if p.is_processed %}
            <span class="text-green-400">Evet</span>
            <span class="block text-xs text-slate-400">{{ p.processed_at }}</span>
          {% else %}
            <span class="text-amber-400">HayÄ±r</span>
          {% endif %}
        </td>
        <td class="px-4 py-2 text-xs max-w-20 truncate" title="{{ p.admin_note or '' }}">{{ p.admin_note or "-" }}</td>
        <td class="px-4 py-2"><a href="/admin/payments/{{ p.id }}" class="text-brand hover:underline">Detay</a></td>
      </tr>
      {% else %}
      <tr><td colspan="10" class="px-4 py-4 text-slate-500">Ã–deme yok.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

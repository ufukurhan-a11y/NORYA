{% extends "admin/base_admin.html" %}
{% block title %}Ödemeler - Norya Admin{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold text-white mb-4">Satış & Ödeme Paneli</h1>
<p class="text-slate-400 text-sm mb-4">Ödemeler (EUR). Webhook: <code class="bg-slate-700 px-1 rounded">/payment/callback</code> veya <code class="bg-slate-700 px-1 rounded">/api/paytr/webhook</code></p>
<div class="flex gap-2 mb-4">
  <a href="/admin/payments" class="px-3 py-1.5 rounded {% if not status_filter %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Tümü</a>
  <a href="/admin/payments?status_filter=completed" class="px-3 py-1.5 rounded {% if status_filter == 'completed' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Başarılı</a>
  <a href="/admin/payments?status_filter=failed" class="px-3 py-1.5 rounded {% if status_filter == 'failed' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Başarısız</a>
  <a href="/admin/payments?status_filter=pending" class="px-3 py-1.5 rounded {% if status_filter == 'pending' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Bekleyen</a>
</div>
<div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
  <table class="w-full text-sm">
    <thead>
      <tr class="text-left text-slate-400 border-b border-slate-700">
        <th class="px-4 py-2">Tarih</th>
        <th class="px-4 py-2">merchant_oid</th>
        <th class="px-4 py-2">Kullanıcı</th>
        <th class="px-4 py-2">Ürün</th>
        <th class="px-4 py-2">Tutar (EUR)</th>
        <th class="px-4 py-2">Durum</th>
        <th class="px-4 py-2">PayTR tx</th>
      </tr>
    </thead>
    <tbody>
      {% for p in payments %}
      <tr class="border-b border-slate-700/50 hover:bg-slate-700/30">
        <td class="px-4 py-2">{{ p.created_at }}</td>
        <td class="px-4 py-2 font-mono text-xs">{{ p.merchant_oid }}</td>
        <td class="px-4 py-2">{{ p.user_email or p.user_id }}</td>
        <td class="px-4 py-2">{{ p.product }}</td>
        <td class="px-4 py-2">{{ "%.2f"|format(p.amount_eur) }} €</td>
        <td class="px-4 py-2"><span class="{% if p.status == 'completed' %}text-green-400{% elif p.status == 'failed' %}text-red-400{% else %}text-amber-400{% endif %}">{{ p.status }}</span></td>
        <td class="px-4 py-2 font-mono text-xs">{{ p.paytr_transaction_id }}</td>
      </tr>
      {% else %}
      <tr><td colspan="7" class="px-4 py-4 text-slate-500">Ödeme yok.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

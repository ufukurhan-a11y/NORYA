{% extends "admin/base_admin.html" %}
{% block title %}Analiz Kuyruğu - Norya Admin{% endblock %}
{% block content %}
<h1 class="text-2xl font-semibold text-white mb-4">AI Analiz Kuyruğu</h1>
<div class="flex gap-2 mb-4">
  <a href="/admin/queue" class="px-3 py-1.5 rounded {% if not status_filter %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Tümü</a>
  <a href="/admin/queue?status_filter=pending" class="px-3 py-1.5 rounded {% if status_filter == 'pending' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Bekleyen</a>
  <a href="/admin/queue?status_filter=processing" class="px-3 py-1.5 rounded {% if status_filter == 'processing' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">İşleniyor</a>
  <a href="/admin/queue?status_filter=done" class="px-3 py-1.5 rounded {% if status_filter == 'done' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Tamamlandı</a>
  <a href="/admin/queue?status_filter=failed" class="px-3 py-1.5 rounded {% if status_filter == 'failed' %}bg-brand text-white{% else %}bg-slate-700 text-slate-300{% endif %}">Başarısız</a>
</div>
<div class="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
  <table class="w-full text-sm">
    <thead>
      <tr class="text-left text-slate-400 border-b border-slate-700">
        <th class="px-4 py-2">ID</th>
        <th class="px-4 py-2">Tarih</th>
        <th class="px-4 py-2">Kullanıcı</th>
        <th class="px-4 py-2">analiz_id</th>
        <th class="px-4 py-2">Durum</th>
        <th class="px-4 py-2">Süre (ms)</th>
        <th class="px-4 py-2">Hata</th>
      </tr>
    </thead>
    <tbody>
      {% for j in jobs %}
      <tr class="border-b border-slate-700/50 hover:bg-slate-700/30">
        <td class="px-4 py-2">{{ j.id }}</td>
        <td class="px-4 py-2">{{ j.created_at }}</td>
        <td class="px-4 py-2">{{ j.user_email or j.user_id }}</td>
        <td class="px-4 py-2">{{ j.analysis_record_id or '-' }}</td>
        <td class="px-4 py-2"><span class="{% if j.status == 'done' %}text-green-400{% elif j.status == 'failed' %}text-red-400{% elif j.status == 'processing' %}text-blue-400{% else %}text-amber-400{% endif %}">{{ j.status }}</span></td>
        <td class="px-4 py-2">{{ j.duration_ms }}</td>
        <td class="px-4 py-2 text-red-300 truncate max-w-xs">{{ j.error_message if j.error_message != '-' else '' }}</td>
      </tr>
      {% else %}
      <tr><td colspan="7" class="px-4 py-4 text-slate-500">Kayıt yok.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
